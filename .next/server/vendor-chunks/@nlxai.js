"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@nlxai";
exports.ids = ["vendor-chunks/@nlxai"];
exports.modules = {

/***/ "(ssr)/./node_modules/@nlxai/chat-core/lib/index.esm.js":
/*!********************************************************!*\
  !*** ./node_modules/@nlxai/chat-core/lib/index.esm.js ***!
  \********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createConversation: () => (/* binding */ createConversation),\n/* harmony export */   getCurrentExpirationTimestamp: () => (/* binding */ getCurrentExpirationTimestamp),\n/* harmony export */   promisify: () => (/* binding */ promisify),\n/* harmony export */   shouldReinitialize: () => (/* binding */ shouldReinitialize)\n/* harmony export */ });\n/* harmony import */ var isomorphic_fetch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! isomorphic-fetch */ \"(ssr)/./node_modules/isomorphic-fetch/fetch-npm-node.js\");\n/* harmony import */ var reconnecting_websocket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! reconnecting-websocket */ \"(ssr)/./node_modules/reconnecting-websocket/dist/reconnecting-websocket-mjs.js\");\n/* harmony import */ var ramda__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ramda */ \"(ssr)/./node_modules/ramda/es/equals.js\");\n/* harmony import */ var ramda__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ramda */ \"(ssr)/./node_modules/ramda/es/adjust.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! uuid */ \"(ssr)/./node_modules/uuid/dist/esm-node/v4.js\");\n\n\n\n\n\nvar name = \"@nlxai/chat-core\";\nvar version = \"0.1.53\";\nvar description = \"NLX Chat SDK core\";\nvar type = \"module\";\nvar main = \"lib/index.cjs\";\nvar module = \"lib/index.esm.js\";\nvar browser = \"lib/index.umd.js\";\nvar types = \"lib/index.d.ts\";\nvar exports = {\n\t\".\": {\n\t\ttypes: \"./lib/index.d.ts\",\n\t\t\"import\": \"./lib/index.esm.js\",\n\t\trequire: \"./lib/index.cjs\"\n\t}\n};\nvar scripts = {\n\tbuild: \"rm -rf lib && rollup -c --configPlugin typescript\",\n\tdocs: \"rm -rf docs/ && typedoc && concat-md --decrease-title-levels --dir-name-as-title docs/ > docs/index.md\",\n\t\"lint:check\": \"eslint src/ --ext .ts,.tsx,.js,.jsx --max-warnings 0\",\n\tlint: \"eslint src/ --ext .ts,.tsx,.js,.jsx --fix\",\n\tprepublish: \"npm run build\",\n\t\"preview-docs\": \"npm run docs && comrak --unsafe --gfm -o docs/index.html docs/index.md && open docs/index.html\",\n\t\"publish-docs\": \"npm run docs && mv docs/index.md ../website/src/content/05-02-headless-api-reference.md\",\n\ttest: \"typedoc --emit none\",\n\ttsc: \"tsc\"\n};\nvar author = \"Peter Szerzo <peter@nlx.ai>\";\nvar license = \"MIT\";\nvar devDependencies = {\n\t\"@types/isomorphic-fetch\": \"^0.0.36\",\n\t\"@types/node\": \"^11.15.11\",\n\t\"@types/ramda\": \"0.29.1\",\n\t\"@types/uuid\": \"^9.0.7\",\n\t\"concat-md\": \"^0.5.1\",\n\t\"eslint-config-nlx\": \"*\",\n\tprettier: \"^3.1.0\",\n\t\"rollup-config-nlx\": \"*\",\n\ttypedoc: \"^0.25.13\",\n\t\"typedoc-plugin-markdown\": \"^3.17.1\",\n\ttypescript: \"^5.5.4\"\n};\nvar dependencies = {\n\t\"isomorphic-fetch\": \"^3.0.0\",\n\tramda: \"^0.29.1\",\n\t\"reconnecting-websocket\": \"^4.4.0\",\n\tuuid: \"^9.0.1\"\n};\nvar publishConfig = {\n\taccess: \"public\"\n};\nvar gitHead = \"82bdb85e97d76034a236332b1a58c6c37e729c54\";\nvar packageJson = {\n\tname: name,\n\tversion: version,\n\tdescription: description,\n\ttype: type,\n\tmain: main,\n\tmodule: module,\n\tbrowser: browser,\n\ttypes: types,\n\texports: exports,\n\tscripts: scripts,\n\tauthor: author,\n\tlicense: license,\n\tdevDependencies: devDependencies,\n\tdependencies: dependencies,\n\tpublishConfig: publishConfig,\n\tgitHead: gitHead\n};\n\n// use a custom Console to indicate we really want to log to the console and it's not incidental. `console.log` causes an eslint error\nconst Console = console;\nconst welcomeIntent = \"NLX.Welcome\";\nconst defaultFailureMessage = \"We encountered an issue. Please try again soon.\";\nconst normalizeSlots = (slotsRecordOrArray) => {\n    if (Array.isArray(slotsRecordOrArray)) {\n        return slotsRecordOrArray;\n    }\n    return Object.entries(slotsRecordOrArray).map(([key, value]) => ({\n        slotId: key,\n        value,\n    }));\n};\nconst fromInternal = (internalState) => internalState.responses;\nconst safeJsonParse = (val) => {\n    try {\n        const json = JSON.parse(val);\n        return json;\n    }\n    catch (_err) {\n        return null;\n    }\n};\n/**\n * Helper method to decide when a new {@link Config} requires creating a new {@link ConversationHandler} or whether the old `Config`'s\n * `ConversationHandler` can be used.\n *\n * The order of configs doesn't matter.\n * @param config1 -\n * @param config2 -\n * @returns true if `createConversation` should be called again\n */\nconst shouldReinitialize = (config1, config2) => {\n    return !(0,ramda__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(config1, config2);\n};\n/**\n * Call this to create a conversation handler.\n * @param config -\n * @returns The {@link ConversationHandler} is a bundle of functions to interact with the conversation.\n */\nfunction createConversation(config) {\n    let socket;\n    // Check if the bot URL has a language code appended to it\n    if (/[-|_][a-z]{2,}[-|_][A-Z]{2,}$/.test(config.botUrl)) {\n        Console.warn(\"Since v1.0.0, the language code is no longer added at the end of the bot URL. Please remove the modifier (e.g. '-en-US') from the URL, and specify it in the `languageCode` parameter instead.\");\n    }\n    const initialConversationId = config.conversationId ?? (0,uuid__WEBPACK_IMPORTED_MODULE_3__[\"default\"])();\n    let state = {\n        responses: config.responses ?? [],\n        userId: config.userId,\n        conversationId: initialConversationId,\n    };\n    const setState = (change, \n    // Optionally send the response that causes the current state change, to be sent to subscribers\n    newResponse) => {\n        state = {\n            ...state,\n            ...change,\n        };\n        subscribers.forEach((subscriber) => {\n            subscriber(fromInternal(state), newResponse);\n        });\n    };\n    const failureHandler = () => {\n        const newResponse = {\n            type: \"failure\",\n            receivedAt: new Date().getTime(),\n            payload: {\n                text: config.failureMessage ?? defaultFailureMessage,\n            },\n        };\n        setState({\n            responses: [...state.responses, newResponse],\n        }, newResponse);\n    };\n    const messageResponseHandler = (response) => {\n        if (response?.messages.length > 0) {\n            const newResponse = {\n                type: \"bot\",\n                receivedAt: new Date().getTime(),\n                payload: {\n                    ...response,\n                    messages: response.messages.map((message) => ({\n                        nodeId: message.nodeId,\n                        messageId: message.messageId,\n                        text: message.text,\n                        choices: message.choices ?? [],\n                    })),\n                },\n            };\n            setState({\n                responses: [...state.responses, newResponse],\n            }, newResponse);\n            if (response.metadata.hasPendingDataRequest) {\n                appendStructuredUserResponse({ poll: true });\n                setTimeout(() => {\n                    void sendToBot({\n                        request: {\n                            structured: {\n                                poll: true,\n                            },\n                        },\n                    });\n                }, 1500);\n            }\n        }\n        else {\n            Console.warn(\"Invalid message structure, expected object with field 'messages'.\");\n            failureHandler();\n        }\n    };\n    let botRequestOverride;\n    let socketMessageQueue = [];\n    let socketMessageQueueCheckInterval = null;\n    const sendToBot = async (body) => {\n        if (botRequestOverride != null) {\n            botRequestOverride(body, (payload) => {\n                const newResponse = {\n                    type: \"bot\",\n                    receivedAt: new Date().getTime(),\n                    payload,\n                };\n                setState({\n                    responses: [...state.responses, newResponse],\n                }, newResponse);\n            });\n            return;\n        }\n        const bodyWithContext = {\n            userId: state.userId,\n            conversationId: state.conversationId,\n            ...body,\n            languageCode: config.languageCode,\n            channelType: config.experimental?.channelType,\n            environment: config.environment,\n        };\n        if (isUsingWebSockets()) {\n            if (socket?.readyState === 1) {\n                socket.send(JSON.stringify(bodyWithContext));\n            }\n            else {\n                socketMessageQueue = [...socketMessageQueue, bodyWithContext];\n            }\n        }\n        else {\n            await isomorphic_fetch__WEBPACK_IMPORTED_MODULE_0__(`${config.botUrl}${config.experimental?.completeBotUrl === true\n                ? \"\"\n                : `-${config.languageCode}`}`, {\n                method: \"POST\",\n                headers: {\n                    ...(config.headers ?? {}),\n                    Accept: \"application/json\",\n                    \"Content-Type\": \"application/json\",\n                    \"nlx-sdk-version\": packageJson.version,\n                },\n                body: JSON.stringify(bodyWithContext),\n            })\n                .then(async (res) => {\n                return await res.json();\n            })\n                .then(messageResponseHandler)\n                .catch((err) => {\n                Console.warn(err);\n                failureHandler();\n            });\n        }\n    };\n    const isUsingWebSockets = () => {\n        return config.botUrl.indexOf(\"wss://\") === 0;\n    };\n    let subscribers = [];\n    const setupWebsocket = () => {\n        const url = new URL(config.botUrl);\n        if (config.experimental?.completeBotUrl !== true) {\n            url.searchParams.set(\"languageCode\", config.languageCode);\n            url.searchParams.set(\"channelKey\", `${url.searchParams.get(\"channelKey\") ?? \"\"}-${config.languageCode}`);\n        }\n        url.searchParams.set(\"conversationId\", state.conversationId);\n        socket = new reconnecting_websocket__WEBPACK_IMPORTED_MODULE_1__[\"default\"](url.href);\n        socketMessageQueueCheckInterval = setInterval(() => {\n        }, 500);\n        socket.onmessage = function (e) {\n            if (typeof e?.data === \"string\") {\n                messageResponseHandler(safeJsonParse(e.data));\n            }\n        };\n    };\n    const teardownWebsocket = () => {\n        if (socketMessageQueueCheckInterval != null) {\n            clearInterval(socketMessageQueueCheckInterval);\n        }\n        if (socket != null) {\n            socket.onmessage = null;\n            socket.close();\n            socket = undefined;\n        }\n    };\n    if (isUsingWebSockets()) {\n        setupWebsocket();\n    }\n    const appendStructuredUserResponse = (structured, context) => {\n        const newResponse = {\n            type: \"user\",\n            receivedAt: new Date().getTime(),\n            payload: {\n                type: \"structured\",\n                ...structured,\n                context,\n            },\n        };\n        setState({\n            responses: [...state.responses, newResponse],\n        }, newResponse);\n    };\n    const sendIntent = (intentId, context) => {\n        appendStructuredUserResponse({ intentId }, context);\n        void sendToBot({\n            context,\n            request: {\n                structured: {\n                    intentId,\n                },\n            },\n        });\n    };\n    const sendText = (text, context) => {\n        const newResponse = {\n            type: \"user\",\n            receivedAt: new Date().getTime(),\n            payload: {\n                type: \"text\",\n                text,\n                context,\n            },\n        };\n        setState({\n            responses: [...state.responses, newResponse],\n        }, newResponse);\n        void sendToBot({\n            context,\n            request: {\n                unstructured: {\n                    text,\n                },\n            },\n        });\n    };\n    const unsubscribe = (subscriber) => {\n        subscribers = subscribers.filter((fn) => fn !== subscriber);\n    };\n    const subscribe = (subscriber) => {\n        subscribers = [...subscribers, subscriber];\n        subscriber(fromInternal(state));\n        return () => {\n            unsubscribe(subscriber);\n        };\n    };\n    return {\n        sendText,\n        sendStructured: (structured, context) => {\n            appendStructuredUserResponse(structured, context);\n            void sendToBot({\n                context,\n                request: {\n                    structured: {\n                        ...structured,\n                        slots: normalizeSlots(structured.slots ?? []),\n                    },\n                },\n            });\n        },\n        sendSlots: (slots, context) => {\n            appendStructuredUserResponse({ slots }, context);\n            void sendToBot({\n                context,\n                request: {\n                    structured: {\n                        slots: normalizeSlots(slots),\n                    },\n                },\n            });\n        },\n        sendIntent,\n        sendWelcomeIntent: (context) => {\n            sendIntent(welcomeIntent, context);\n        },\n        sendChoice: (choiceId, context, metadata) => {\n            let newResponses = [...state.responses];\n            const choiceResponse = {\n                type: \"user\",\n                receivedAt: new Date().getTime(),\n                payload: {\n                    type: \"choice\",\n                    choiceId,\n                },\n            };\n            const responseIndex = metadata?.responseIndex ?? -1;\n            const messageIndex = metadata?.messageIndex ?? -1;\n            if (responseIndex > -1 && messageIndex > -1) {\n                newResponses = (0,ramda__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(responseIndex, (response) => response.type === \"bot\"\n                    ? {\n                        ...response,\n                        payload: {\n                            ...response.payload,\n                            messages: (0,ramda__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(messageIndex, (message) => ({ ...message, selectedChoiceId: choiceId }), response.payload.messages),\n                        },\n                    }\n                    : response, newResponses);\n            }\n            newResponses = [...newResponses, choiceResponse];\n            setState({\n                responses: newResponses,\n            }, choiceResponse);\n            void sendToBot({\n                context,\n                request: {\n                    structured: {\n                        nodeId: metadata?.nodeId,\n                        intentId: metadata?.intentId,\n                        choiceId,\n                    },\n                },\n            });\n        },\n        currentConversationId: () => {\n            return state.conversationId;\n        },\n        subscribe,\n        unsubscribe,\n        unsubscribeAll: () => {\n            subscribers = [];\n        },\n        reset: (options) => {\n            setState({\n                conversationId: (0,uuid__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(),\n                responses: options?.clearResponses === true ? [] : state.responses,\n            });\n            if (isUsingWebSockets()) {\n                teardownWebsocket();\n                setupWebsocket();\n            }\n        },\n        destroy: () => {\n            subscribers = [];\n            if (isUsingWebSockets()) {\n                teardownWebsocket();\n            }\n        },\n        setBotRequestOverride: (val) => {\n            botRequestOverride = val;\n        },\n    };\n}\n/**\n * Get current expiration timestamp from the current list of reponses\n * @param responses - the current list of user and bot responses (first argument in the subscribe callback)\n * @returns an expiration timestamp in Unix Epoch (`new Date().getTime()`), or `null` if this is not known (typically occurs if the bot has not responded yet)\n */\nconst getCurrentExpirationTimestamp = (responses) => {\n    let expirationTimestamp = null;\n    responses.forEach((response) => {\n        if (response.type === \"bot\" &&\n            response.payload.expirationTimestamp != null) {\n            expirationTimestamp = response.payload.expirationTimestamp;\n        }\n    });\n    return expirationTimestamp;\n};\n/**\n * This package is intentionally designed with a subscription-based API as opposed to a promise-based one where each message corresponds to a single bot response, available asynchronously.\n *\n * If you need a promise-based wrapper, you can use the `promisify` helper available in the package:\n * @example\n * ```typescript\n * import { createConversation, promisify } from \"@nlxai/chat-core\";\n *\n * const convo = createConversation(config);\n *\n * const sendTextWrapped = promisify(convo.sendText, convo);\n *\n * sendTextWrapped(\"Hello\").then((response) => {\n *   console.log(response);\n * });\n * ```\n * @typeParam T - the type of the function's params, e.g. for `sendText` it's `text: string, context?: Context`\n * @param fn - the function to wrap (e.g. `convo.sendText`, `convo.sendChoice`, etc.)\n * @param convo - the `ConversationHandler` (from {@link createConversation})\n * @param timeout - the timeout in milliseconds\n * @returns A promise-wrapped version of the function. The function, when called, returns a promise that resolves to the Conversation's next response.\n */\nfunction promisify(fn, convo, timeout = 10000) {\n    return async (payload) => {\n        return await new Promise((resolve, reject) => {\n            const timeoutId = setTimeout(() => {\n                reject(new Error(\"The request timed out.\"));\n                convo.unsubscribe(subscription);\n            }, timeout);\n            const subscription = (_responses, newResponse) => {\n                if (newResponse?.type === \"bot\" || newResponse?.type === \"failure\") {\n                    clearTimeout(timeoutId);\n                    convo.unsubscribe(subscription);\n                    resolve(newResponse);\n                }\n            };\n            convo.subscribe(subscription);\n            fn(payload);\n        });\n    };\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQG5seGFpL2NoYXQtY29yZS9saWIvaW5kZXguZXNtLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFxQztBQUNzQjtBQUNwQjtBQUNiOztBQUUxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsY0FBYyx5QkFBeUIsMkJBQTJCO0FBQ3pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGlEQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLDJCQUEyQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixHQUFHLFdBQVcsR0FBRztBQUNyQztBQUNBO0FBQ0EsMkRBQTJELGdEQUFFO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FB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QSxnQ0FBZ0MsZ0RBQUU7QUFDbEM7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksZ0NBQWdDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCx5QkFBeUI7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUU0RiIsInNvdXJjZXMiOlsid2VicGFjazovL21hbnRpbmUtbWluaW1hbC1uZXh0LXRlbXBsYXRlLy4vbm9kZV9tb2R1bGVzL0BubHhhaS9jaGF0LWNvcmUvbGliL2luZGV4LmVzbS5qcz82YzEzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmZXRjaCBmcm9tICdpc29tb3JwaGljLWZldGNoJztcbmltcG9ydCBSZWNvbm5lY3RpbmdXZWJTb2NrZXQgZnJvbSAncmVjb25uZWN0aW5nLXdlYnNvY2tldCc7XG5pbXBvcnQgeyBlcXVhbHMsIGFkanVzdCB9IGZyb20gJ3JhbWRhJztcbmltcG9ydCB7IHY0IH0gZnJvbSAndXVpZCc7XG5cbnZhciBuYW1lID0gXCJAbmx4YWkvY2hhdC1jb3JlXCI7XG52YXIgdmVyc2lvbiA9IFwiMC4xLjUzXCI7XG52YXIgZGVzY3JpcHRpb24gPSBcIk5MWCBDaGF0IFNESyBjb3JlXCI7XG52YXIgdHlwZSA9IFwibW9kdWxlXCI7XG52YXIgbWFpbiA9IFwibGliL2luZGV4LmNqc1wiO1xudmFyIG1vZHVsZSA9IFwibGliL2luZGV4LmVzbS5qc1wiO1xudmFyIGJyb3dzZXIgPSBcImxpYi9pbmRleC51bWQuanNcIjtcbnZhciB0eXBlcyA9IFwibGliL2luZGV4LmQudHNcIjtcbnZhciBleHBvcnRzID0ge1xuXHRcIi5cIjoge1xuXHRcdHR5cGVzOiBcIi4vbGliL2luZGV4LmQudHNcIixcblx0XHRcImltcG9ydFwiOiBcIi4vbGliL2luZGV4LmVzbS5qc1wiLFxuXHRcdHJlcXVpcmU6IFwiLi9saWIvaW5kZXguY2pzXCJcblx0fVxufTtcbnZhciBzY3JpcHRzID0ge1xuXHRidWlsZDogXCJybSAtcmYgbGliICYmIHJvbGx1cCAtYyAtLWNvbmZpZ1BsdWdpbiB0eXBlc2NyaXB0XCIsXG5cdGRvY3M6IFwicm0gLXJmIGRvY3MvICYmIHR5cGVkb2MgJiYgY29uY2F0LW1kIC0tZGVjcmVhc2UtdGl0bGUtbGV2ZWxzIC0tZGlyLW5hbWUtYXMtdGl0bGUgZG9jcy8gPiBkb2NzL2luZGV4Lm1kXCIsXG5cdFwibGludDpjaGVja1wiOiBcImVzbGludCBzcmMvIC0tZXh0IC50cywudHN4LC5qcywuanN4IC0tbWF4LXdhcm5pbmdzIDBcIixcblx0bGludDogXCJlc2xpbnQgc3JjLyAtLWV4dCAudHMsLnRzeCwuanMsLmpzeCAtLWZpeFwiLFxuXHRwcmVwdWJsaXNoOiBcIm5wbSBydW4gYnVpbGRcIixcblx0XCJwcmV2aWV3LWRvY3NcIjogXCJucG0gcnVuIGRvY3MgJiYgY29tcmFrIC0tdW5zYWZlIC0tZ2ZtIC1vIGRvY3MvaW5kZXguaHRtbCBkb2NzL2luZGV4Lm1kICYmIG9wZW4gZG9jcy9pbmRleC5odG1sXCIsXG5cdFwicHVibGlzaC1kb2NzXCI6IFwibnBtIHJ1biBkb2NzICYmIG12IGRvY3MvaW5kZXgubWQgLi4vd2Vic2l0ZS9zcmMvY29udGVudC8wNS0wMi1oZWFkbGVzcy1hcGktcmVmZXJlbmNlLm1kXCIsXG5cdHRlc3Q6IFwidHlwZWRvYyAtLWVtaXQgbm9uZVwiLFxuXHR0c2M6IFwidHNjXCJcbn07XG52YXIgYXV0aG9yID0gXCJQZXRlciBTemVyem8gPHBldGVyQG5seC5haT5cIjtcbnZhciBsaWNlbnNlID0gXCJNSVRcIjtcbnZhciBkZXZEZXBlbmRlbmNpZXMgPSB7XG5cdFwiQHR5cGVzL2lzb21vcnBoaWMtZmV0Y2hcIjogXCJeMC4wLjM2XCIsXG5cdFwiQHR5cGVzL25vZGVcIjogXCJeMTEuMTUuMTFcIixcblx0XCJAdHlwZXMvcmFtZGFcIjogXCIwLjI5LjFcIixcblx0XCJAdHlwZXMvdXVpZFwiOiBcIl45LjAuN1wiLFxuXHRcImNvbmNhdC1tZFwiOiBcIl4wLjUuMVwiLFxuXHRcImVzbGludC1jb25maWctbmx4XCI6IFwiKlwiLFxuXHRwcmV0dGllcjogXCJeMy4xLjBcIixcblx0XCJyb2xsdXAtY29uZmlnLW5seFwiOiBcIipcIixcblx0dHlwZWRvYzogXCJeMC4yNS4xM1wiLFxuXHRcInR5cGVkb2MtcGx1Z2luLW1hcmtkb3duXCI6IFwiXjMuMTcuMVwiLFxuXHR0eXBlc2NyaXB0OiBcIl41LjUuNFwiXG59O1xudmFyIGRlcGVuZGVuY2llcyA9IHtcblx0XCJpc29tb3JwaGljLWZldGNoXCI6IFwiXjMuMC4wXCIsXG5cdHJhbWRhOiBcIl4wLjI5LjFcIixcblx0XCJyZWNvbm5lY3Rpbmctd2Vic29ja2V0XCI6IFwiXjQuNC4wXCIsXG5cdHV1aWQ6IFwiXjkuMC4xXCJcbn07XG52YXIgcHVibGlzaENvbmZpZyA9IHtcblx0YWNjZXNzOiBcInB1YmxpY1wiXG59O1xudmFyIGdpdEhlYWQgPSBcIjgyYmRiODVlOTdkNzYwMzRhMjM2MzMyYjFhNThjNmMzN2U3MjljNTRcIjtcbnZhciBwYWNrYWdlSnNvbiA9IHtcblx0bmFtZTogbmFtZSxcblx0dmVyc2lvbjogdmVyc2lvbixcblx0ZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxuXHR0eXBlOiB0eXBlLFxuXHRtYWluOiBtYWluLFxuXHRtb2R1bGU6IG1vZHVsZSxcblx0YnJvd3NlcjogYnJvd3Nlcixcblx0dHlwZXM6IHR5cGVzLFxuXHRleHBvcnRzOiBleHBvcnRzLFxuXHRzY3JpcHRzOiBzY3JpcHRzLFxuXHRhdXRob3I6IGF1dGhvcixcblx0bGljZW5zZTogbGljZW5zZSxcblx0ZGV2RGVwZW5kZW5jaWVzOiBkZXZEZXBlbmRlbmNpZXMsXG5cdGRlcGVuZGVuY2llczogZGVwZW5kZW5jaWVzLFxuXHRwdWJsaXNoQ29uZmlnOiBwdWJsaXNoQ29uZmlnLFxuXHRnaXRIZWFkOiBnaXRIZWFkXG59O1xuXG4vLyB1c2UgYSBjdXN0b20gQ29uc29sZSB0byBpbmRpY2F0ZSB3ZSByZWFsbHkgd2FudCB0byBsb2cgdG8gdGhlIGNvbnNvbGUgYW5kIGl0J3Mgbm90IGluY2lkZW50YWwuIGBjb25zb2xlLmxvZ2AgY2F1c2VzIGFuIGVzbGludCBlcnJvclxuY29uc3QgQ29uc29sZSA9IGNvbnNvbGU7XG5jb25zdCB3ZWxjb21lSW50ZW50ID0gXCJOTFguV2VsY29tZVwiO1xuY29uc3QgZGVmYXVsdEZhaWx1cmVNZXNzYWdlID0gXCJXZSBlbmNvdW50ZXJlZCBhbiBpc3N1ZS4gUGxlYXNlIHRyeSBhZ2FpbiBzb29uLlwiO1xuY29uc3Qgbm9ybWFsaXplU2xvdHMgPSAoc2xvdHNSZWNvcmRPckFycmF5KSA9PiB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoc2xvdHNSZWNvcmRPckFycmF5KSkge1xuICAgICAgICByZXR1cm4gc2xvdHNSZWNvcmRPckFycmF5O1xuICAgIH1cbiAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoc2xvdHNSZWNvcmRPckFycmF5KS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gKHtcbiAgICAgICAgc2xvdElkOiBrZXksXG4gICAgICAgIHZhbHVlLFxuICAgIH0pKTtcbn07XG5jb25zdCBmcm9tSW50ZXJuYWwgPSAoaW50ZXJuYWxTdGF0ZSkgPT4gaW50ZXJuYWxTdGF0ZS5yZXNwb25zZXM7XG5jb25zdCBzYWZlSnNvblBhcnNlID0gKHZhbCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHZhbCk7XG4gICAgICAgIHJldHVybiBqc29uO1xuICAgIH1cbiAgICBjYXRjaCAoX2Vycikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59O1xuLyoqXG4gKiBIZWxwZXIgbWV0aG9kIHRvIGRlY2lkZSB3aGVuIGEgbmV3IHtAbGluayBDb25maWd9IHJlcXVpcmVzIGNyZWF0aW5nIGEgbmV3IHtAbGluayBDb252ZXJzYXRpb25IYW5kbGVyfSBvciB3aGV0aGVyIHRoZSBvbGQgYENvbmZpZ2Anc1xuICogYENvbnZlcnNhdGlvbkhhbmRsZXJgIGNhbiBiZSB1c2VkLlxuICpcbiAqIFRoZSBvcmRlciBvZiBjb25maWdzIGRvZXNuJ3QgbWF0dGVyLlxuICogQHBhcmFtIGNvbmZpZzEgLVxuICogQHBhcmFtIGNvbmZpZzIgLVxuICogQHJldHVybnMgdHJ1ZSBpZiBgY3JlYXRlQ29udmVyc2F0aW9uYCBzaG91bGQgYmUgY2FsbGVkIGFnYWluXG4gKi9cbmNvbnN0IHNob3VsZFJlaW5pdGlhbGl6ZSA9IChjb25maWcxLCBjb25maWcyKSA9PiB7XG4gICAgcmV0dXJuICFlcXVhbHMoY29uZmlnMSwgY29uZmlnMik7XG59O1xuLyoqXG4gKiBDYWxsIHRoaXMgdG8gY3JlYXRlIGEgY29udmVyc2F0aW9uIGhhbmRsZXIuXG4gKiBAcGFyYW0gY29uZmlnIC1cbiAqIEByZXR1cm5zIFRoZSB7QGxpbmsgQ29udmVyc2F0aW9uSGFuZGxlcn0gaXMgYSBidW5kbGUgb2YgZnVuY3Rpb25zIHRvIGludGVyYWN0IHdpdGggdGhlIGNvbnZlcnNhdGlvbi5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlQ29udmVyc2F0aW9uKGNvbmZpZykge1xuICAgIGxldCBzb2NrZXQ7XG4gICAgLy8gQ2hlY2sgaWYgdGhlIGJvdCBVUkwgaGFzIGEgbGFuZ3VhZ2UgY29kZSBhcHBlbmRlZCB0byBpdFxuICAgIGlmICgvWy18X11bYS16XXsyLH1bLXxfXVtBLVpdezIsfSQvLnRlc3QoY29uZmlnLmJvdFVybCkpIHtcbiAgICAgICAgQ29uc29sZS53YXJuKFwiU2luY2UgdjEuMC4wLCB0aGUgbGFuZ3VhZ2UgY29kZSBpcyBubyBsb25nZXIgYWRkZWQgYXQgdGhlIGVuZCBvZiB0aGUgYm90IFVSTC4gUGxlYXNlIHJlbW92ZSB0aGUgbW9kaWZpZXIgKGUuZy4gJy1lbi1VUycpIGZyb20gdGhlIFVSTCwgYW5kIHNwZWNpZnkgaXQgaW4gdGhlIGBsYW5ndWFnZUNvZGVgIHBhcmFtZXRlciBpbnN0ZWFkLlwiKTtcbiAgICB9XG4gICAgY29uc3QgaW5pdGlhbENvbnZlcnNhdGlvbklkID0gY29uZmlnLmNvbnZlcnNhdGlvbklkID8/IHY0KCk7XG4gICAgbGV0IHN0YXRlID0ge1xuICAgICAgICByZXNwb25zZXM6IGNvbmZpZy5yZXNwb25zZXMgPz8gW10sXG4gICAgICAgIHVzZXJJZDogY29uZmlnLnVzZXJJZCxcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IGluaXRpYWxDb252ZXJzYXRpb25JZCxcbiAgICB9O1xuICAgIGNvbnN0IHNldFN0YXRlID0gKGNoYW5nZSwgXG4gICAgLy8gT3B0aW9uYWxseSBzZW5kIHRoZSByZXNwb25zZSB0aGF0IGNhdXNlcyB0aGUgY3VycmVudCBzdGF0ZSBjaGFuZ2UsIHRvIGJlIHNlbnQgdG8gc3Vic2NyaWJlcnNcbiAgICBuZXdSZXNwb25zZSkgPT4ge1xuICAgICAgICBzdGF0ZSA9IHtcbiAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgLi4uY2hhbmdlLFxuICAgICAgICB9O1xuICAgICAgICBzdWJzY3JpYmVycy5mb3JFYWNoKChzdWJzY3JpYmVyKSA9PiB7XG4gICAgICAgICAgICBzdWJzY3JpYmVyKGZyb21JbnRlcm5hbChzdGF0ZSksIG5ld1Jlc3BvbnNlKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjb25zdCBmYWlsdXJlSGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgbmV3UmVzcG9uc2UgPSB7XG4gICAgICAgICAgICB0eXBlOiBcImZhaWx1cmVcIixcbiAgICAgICAgICAgIHJlY2VpdmVkQXQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgICAgIHRleHQ6IGNvbmZpZy5mYWlsdXJlTWVzc2FnZSA/PyBkZWZhdWx0RmFpbHVyZU1lc3NhZ2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICBzZXRTdGF0ZSh7XG4gICAgICAgICAgICByZXNwb25zZXM6IFsuLi5zdGF0ZS5yZXNwb25zZXMsIG5ld1Jlc3BvbnNlXSxcbiAgICAgICAgfSwgbmV3UmVzcG9uc2UpO1xuICAgIH07XG4gICAgY29uc3QgbWVzc2FnZVJlc3BvbnNlSGFuZGxlciA9IChyZXNwb25zZSkgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2U/Lm1lc3NhZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1Jlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiYm90XCIsXG4gICAgICAgICAgICAgICAgcmVjZWl2ZWRBdDogbmV3IERhdGUoKS5nZXRUaW1lKCksXG4gICAgICAgICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgICAgICAgICAuLi5yZXNwb25zZSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZXM6IHJlc3BvbnNlLm1lc3NhZ2VzLm1hcCgobWVzc2FnZSkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVJZDogbWVzc2FnZS5ub2RlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlSWQ6IG1lc3NhZ2UubWVzc2FnZUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZS50ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hvaWNlczogbWVzc2FnZS5jaG9pY2VzID8/IFtdLFxuICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VzOiBbLi4uc3RhdGUucmVzcG9uc2VzLCBuZXdSZXNwb25zZV0sXG4gICAgICAgICAgICB9LCBuZXdSZXNwb25zZSk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UubWV0YWRhdGEuaGFzUGVuZGluZ0RhdGFSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgYXBwZW5kU3RydWN0dXJlZFVzZXJSZXNwb25zZSh7IHBvbGw6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZvaWQgc2VuZFRvQm90KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3R1cmVkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvbGw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDE1MDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgQ29uc29sZS53YXJuKFwiSW52YWxpZCBtZXNzYWdlIHN0cnVjdHVyZSwgZXhwZWN0ZWQgb2JqZWN0IHdpdGggZmllbGQgJ21lc3NhZ2VzJy5cIik7XG4gICAgICAgICAgICBmYWlsdXJlSGFuZGxlcigpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBsZXQgYm90UmVxdWVzdE92ZXJyaWRlO1xuICAgIGxldCBzb2NrZXRNZXNzYWdlUXVldWUgPSBbXTtcbiAgICBsZXQgc29ja2V0TWVzc2FnZVF1ZXVlQ2hlY2tJbnRlcnZhbCA9IG51bGw7XG4gICAgY29uc3Qgc2VuZFRvQm90ID0gYXN5bmMgKGJvZHkpID0+IHtcbiAgICAgICAgaWYgKGJvdFJlcXVlc3RPdmVycmlkZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBib3RSZXF1ZXN0T3ZlcnJpZGUoYm9keSwgKHBheWxvYWQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdSZXNwb25zZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib3RcIixcbiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWRBdDogbmV3IERhdGUoKS5nZXRUaW1lKCksXG4gICAgICAgICAgICAgICAgICAgIHBheWxvYWQsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBzZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlczogWy4uLnN0YXRlLnJlc3BvbnNlcywgbmV3UmVzcG9uc2VdLFxuICAgICAgICAgICAgICAgIH0sIG5ld1Jlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJvZHlXaXRoQ29udGV4dCA9IHtcbiAgICAgICAgICAgIHVzZXJJZDogc3RhdGUudXNlcklkLFxuICAgICAgICAgICAgY29udmVyc2F0aW9uSWQ6IHN0YXRlLmNvbnZlcnNhdGlvbklkLFxuICAgICAgICAgICAgLi4uYm9keSxcbiAgICAgICAgICAgIGxhbmd1YWdlQ29kZTogY29uZmlnLmxhbmd1YWdlQ29kZSxcbiAgICAgICAgICAgIGNoYW5uZWxUeXBlOiBjb25maWcuZXhwZXJpbWVudGFsPy5jaGFubmVsVHlwZSxcbiAgICAgICAgICAgIGVudmlyb25tZW50OiBjb25maWcuZW52aXJvbm1lbnQsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChpc1VzaW5nV2ViU29ja2V0cygpKSB7XG4gICAgICAgICAgICBpZiAoc29ja2V0Py5yZWFkeVN0YXRlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoYm9keVdpdGhDb250ZXh0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzb2NrZXRNZXNzYWdlUXVldWUgPSBbLi4uc29ja2V0TWVzc2FnZVF1ZXVlLCBib2R5V2l0aENvbnRleHRdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgZmV0Y2goYCR7Y29uZmlnLmJvdFVybH0ke2NvbmZpZy5leHBlcmltZW50YWw/LmNvbXBsZXRlQm90VXJsID09PSB0cnVlXG4gICAgICAgICAgICAgICAgPyBcIlwiXG4gICAgICAgICAgICAgICAgOiBgLSR7Y29uZmlnLmxhbmd1YWdlQ29kZX1gfWAsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uKGNvbmZpZy5oZWFkZXJzID8/IHt9KSxcbiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibmx4LXNkay12ZXJzaW9uXCI6IHBhY2thZ2VKc29uLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5V2l0aENvbnRleHQpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJlcy5qc29uKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKG1lc3NhZ2VSZXNwb25zZUhhbmRsZXIpXG4gICAgICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICBDb25zb2xlLndhcm4oZXJyKTtcbiAgICAgICAgICAgICAgICBmYWlsdXJlSGFuZGxlcigpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGlzVXNpbmdXZWJTb2NrZXRzID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gY29uZmlnLmJvdFVybC5pbmRleE9mKFwid3NzOi8vXCIpID09PSAwO1xuICAgIH07XG4gICAgbGV0IHN1YnNjcmliZXJzID0gW107XG4gICAgY29uc3Qgc2V0dXBXZWJzb2NrZXQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoY29uZmlnLmJvdFVybCk7XG4gICAgICAgIGlmIChjb25maWcuZXhwZXJpbWVudGFsPy5jb21wbGV0ZUJvdFVybCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJsYW5ndWFnZUNvZGVcIiwgY29uZmlnLmxhbmd1YWdlQ29kZSk7XG4gICAgICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImNoYW5uZWxLZXlcIiwgYCR7dXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJjaGFubmVsS2V5XCIpID8/IFwiXCJ9LSR7Y29uZmlnLmxhbmd1YWdlQ29kZX1gKTtcbiAgICAgICAgfVxuICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImNvbnZlcnNhdGlvbklkXCIsIHN0YXRlLmNvbnZlcnNhdGlvbklkKTtcbiAgICAgICAgc29ja2V0ID0gbmV3IFJlY29ubmVjdGluZ1dlYlNvY2tldCh1cmwuaHJlZik7XG4gICAgICAgIHNvY2tldE1lc3NhZ2VRdWV1ZUNoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIH0sIDUwMCk7XG4gICAgICAgIHNvY2tldC5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBlPy5kYXRhID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZVJlc3BvbnNlSGFuZGxlcihzYWZlSnNvblBhcnNlKGUuZGF0YSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG4gICAgY29uc3QgdGVhcmRvd25XZWJzb2NrZXQgPSAoKSA9PiB7XG4gICAgICAgIGlmIChzb2NrZXRNZXNzYWdlUXVldWVDaGVja0ludGVydmFsICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc29ja2V0TWVzc2FnZVF1ZXVlQ2hlY2tJbnRlcnZhbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNvY2tldCAhPSBudWxsKSB7XG4gICAgICAgICAgICBzb2NrZXQub25tZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgIHNvY2tldC5jbG9zZSgpO1xuICAgICAgICAgICAgc29ja2V0ID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBpZiAoaXNVc2luZ1dlYlNvY2tldHMoKSkge1xuICAgICAgICBzZXR1cFdlYnNvY2tldCgpO1xuICAgIH1cbiAgICBjb25zdCBhcHBlbmRTdHJ1Y3R1cmVkVXNlclJlc3BvbnNlID0gKHN0cnVjdHVyZWQsIGNvbnRleHQpID0+IHtcbiAgICAgICAgY29uc3QgbmV3UmVzcG9uc2UgPSB7XG4gICAgICAgICAgICB0eXBlOiBcInVzZXJcIixcbiAgICAgICAgICAgIHJlY2VpdmVkQXQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwic3RydWN0dXJlZFwiLFxuICAgICAgICAgICAgICAgIC4uLnN0cnVjdHVyZWQsXG4gICAgICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgIHJlc3BvbnNlczogWy4uLnN0YXRlLnJlc3BvbnNlcywgbmV3UmVzcG9uc2VdLFxuICAgICAgICB9LCBuZXdSZXNwb25zZSk7XG4gICAgfTtcbiAgICBjb25zdCBzZW5kSW50ZW50ID0gKGludGVudElkLCBjb250ZXh0KSA9PiB7XG4gICAgICAgIGFwcGVuZFN0cnVjdHVyZWRVc2VyUmVzcG9uc2UoeyBpbnRlbnRJZCB9LCBjb250ZXh0KTtcbiAgICAgICAgdm9pZCBzZW5kVG9Cb3Qoe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIHJlcXVlc3Q6IHtcbiAgICAgICAgICAgICAgICBzdHJ1Y3R1cmVkOiB7XG4gICAgICAgICAgICAgICAgICAgIGludGVudElkLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGNvbnN0IHNlbmRUZXh0ID0gKHRleHQsIGNvbnRleHQpID0+IHtcbiAgICAgICAgY29uc3QgbmV3UmVzcG9uc2UgPSB7XG4gICAgICAgICAgICB0eXBlOiBcInVzZXJcIixcbiAgICAgICAgICAgIHJlY2VpdmVkQXQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgIHJlc3BvbnNlczogWy4uLnN0YXRlLnJlc3BvbnNlcywgbmV3UmVzcG9uc2VdLFxuICAgICAgICB9LCBuZXdSZXNwb25zZSk7XG4gICAgICAgIHZvaWQgc2VuZFRvQm90KHtcbiAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICByZXF1ZXN0OiB7XG4gICAgICAgICAgICAgICAgdW5zdHJ1Y3R1cmVkOiB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgY29uc3QgdW5zdWJzY3JpYmUgPSAoc3Vic2NyaWJlcikgPT4ge1xuICAgICAgICBzdWJzY3JpYmVycyA9IHN1YnNjcmliZXJzLmZpbHRlcigoZm4pID0+IGZuICE9PSBzdWJzY3JpYmVyKTtcbiAgICB9O1xuICAgIGNvbnN0IHN1YnNjcmliZSA9IChzdWJzY3JpYmVyKSA9PiB7XG4gICAgICAgIHN1YnNjcmliZXJzID0gWy4uLnN1YnNjcmliZXJzLCBzdWJzY3JpYmVyXTtcbiAgICAgICAgc3Vic2NyaWJlcihmcm9tSW50ZXJuYWwoc3RhdGUpKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHVuc3Vic2NyaWJlKHN1YnNjcmliZXIpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2VuZFRleHQsXG4gICAgICAgIHNlbmRTdHJ1Y3R1cmVkOiAoc3RydWN0dXJlZCwgY29udGV4dCkgPT4ge1xuICAgICAgICAgICAgYXBwZW5kU3RydWN0dXJlZFVzZXJSZXNwb25zZShzdHJ1Y3R1cmVkLCBjb250ZXh0KTtcbiAgICAgICAgICAgIHZvaWQgc2VuZFRvQm90KHtcbiAgICAgICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uc3RydWN0dXJlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsb3RzOiBub3JtYWxpemVTbG90cyhzdHJ1Y3R1cmVkLnNsb3RzID8/IFtdKSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNlbmRTbG90czogKHNsb3RzLCBjb250ZXh0KSA9PiB7XG4gICAgICAgICAgICBhcHBlbmRTdHJ1Y3R1cmVkVXNlclJlc3BvbnNlKHsgc2xvdHMgfSwgY29udGV4dCk7XG4gICAgICAgICAgICB2b2lkIHNlbmRUb0JvdCh7XG4gICAgICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgICAgICByZXF1ZXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsb3RzOiBub3JtYWxpemVTbG90cyhzbG90cyksXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBzZW5kSW50ZW50LFxuICAgICAgICBzZW5kV2VsY29tZUludGVudDogKGNvbnRleHQpID0+IHtcbiAgICAgICAgICAgIHNlbmRJbnRlbnQod2VsY29tZUludGVudCwgY29udGV4dCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNlbmRDaG9pY2U6IChjaG9pY2VJZCwgY29udGV4dCwgbWV0YWRhdGEpID0+IHtcbiAgICAgICAgICAgIGxldCBuZXdSZXNwb25zZXMgPSBbLi4uc3RhdGUucmVzcG9uc2VzXTtcbiAgICAgICAgICAgIGNvbnN0IGNob2ljZVJlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwidXNlclwiLFxuICAgICAgICAgICAgICAgIHJlY2VpdmVkQXQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJjaG9pY2VcIixcbiAgICAgICAgICAgICAgICAgICAgY2hvaWNlSWQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZUluZGV4ID0gbWV0YWRhdGE/LnJlc3BvbnNlSW5kZXggPz8gLTE7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlSW5kZXggPSBtZXRhZGF0YT8ubWVzc2FnZUluZGV4ID8/IC0xO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlSW5kZXggPiAtMSAmJiBtZXNzYWdlSW5kZXggPiAtMSkge1xuICAgICAgICAgICAgICAgIG5ld1Jlc3BvbnNlcyA9IGFkanVzdChyZXNwb25zZUluZGV4LCAocmVzcG9uc2UpID0+IHJlc3BvbnNlLnR5cGUgPT09IFwiYm90XCJcbiAgICAgICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5yZXNwb25zZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5yZXNwb25zZS5wYXlsb2FkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBhZGp1c3QobWVzc2FnZUluZGV4LCAobWVzc2FnZSkgPT4gKHsgLi4ubWVzc2FnZSwgc2VsZWN0ZWRDaG9pY2VJZDogY2hvaWNlSWQgfSksIHJlc3BvbnNlLnBheWxvYWQubWVzc2FnZXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLCBuZXdSZXNwb25zZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3UmVzcG9uc2VzID0gWy4uLm5ld1Jlc3BvbnNlcywgY2hvaWNlUmVzcG9uc2VdO1xuICAgICAgICAgICAgc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlczogbmV3UmVzcG9uc2VzLFxuICAgICAgICAgICAgfSwgY2hvaWNlUmVzcG9uc2UpO1xuICAgICAgICAgICAgdm9pZCBzZW5kVG9Cb3Qoe1xuICAgICAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzdHJ1Y3R1cmVkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlSWQ6IG1ldGFkYXRhPy5ub2RlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnRJZDogbWV0YWRhdGE/LmludGVudElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hvaWNlSWQsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBjdXJyZW50Q29udmVyc2F0aW9uSWQ6ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5jb252ZXJzYXRpb25JZDtcbiAgICAgICAgfSxcbiAgICAgICAgc3Vic2NyaWJlLFxuICAgICAgICB1bnN1YnNjcmliZSxcbiAgICAgICAgdW5zdWJzY3JpYmVBbGw6ICgpID0+IHtcbiAgICAgICAgICAgIHN1YnNjcmliZXJzID0gW107XG4gICAgICAgIH0sXG4gICAgICAgIHJlc2V0OiAob3B0aW9ucykgPT4ge1xuICAgICAgICAgICAgc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiB2NCgpLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlczogb3B0aW9ucz8uY2xlYXJSZXNwb25zZXMgPT09IHRydWUgPyBbXSA6IHN0YXRlLnJlc3BvbnNlcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGlzVXNpbmdXZWJTb2NrZXRzKCkpIHtcbiAgICAgICAgICAgICAgICB0ZWFyZG93bldlYnNvY2tldCgpO1xuICAgICAgICAgICAgICAgIHNldHVwV2Vic29ja2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlc3Ryb3k6ICgpID0+IHtcbiAgICAgICAgICAgIHN1YnNjcmliZXJzID0gW107XG4gICAgICAgICAgICBpZiAoaXNVc2luZ1dlYlNvY2tldHMoKSkge1xuICAgICAgICAgICAgICAgIHRlYXJkb3duV2Vic29ja2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNldEJvdFJlcXVlc3RPdmVycmlkZTogKHZhbCkgPT4ge1xuICAgICAgICAgICAgYm90UmVxdWVzdE92ZXJyaWRlID0gdmFsO1xuICAgICAgICB9LFxuICAgIH07XG59XG4vKipcbiAqIEdldCBjdXJyZW50IGV4cGlyYXRpb24gdGltZXN0YW1wIGZyb20gdGhlIGN1cnJlbnQgbGlzdCBvZiByZXBvbnNlc1xuICogQHBhcmFtIHJlc3BvbnNlcyAtIHRoZSBjdXJyZW50IGxpc3Qgb2YgdXNlciBhbmQgYm90IHJlc3BvbnNlcyAoZmlyc3QgYXJndW1lbnQgaW4gdGhlIHN1YnNjcmliZSBjYWxsYmFjaylcbiAqIEByZXR1cm5zIGFuIGV4cGlyYXRpb24gdGltZXN0YW1wIGluIFVuaXggRXBvY2ggKGBuZXcgRGF0ZSgpLmdldFRpbWUoKWApLCBvciBgbnVsbGAgaWYgdGhpcyBpcyBub3Qga25vd24gKHR5cGljYWxseSBvY2N1cnMgaWYgdGhlIGJvdCBoYXMgbm90IHJlc3BvbmRlZCB5ZXQpXG4gKi9cbmNvbnN0IGdldEN1cnJlbnRFeHBpcmF0aW9uVGltZXN0YW1wID0gKHJlc3BvbnNlcykgPT4ge1xuICAgIGxldCBleHBpcmF0aW9uVGltZXN0YW1wID0gbnVsbDtcbiAgICByZXNwb25zZXMuZm9yRWFjaCgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnR5cGUgPT09IFwiYm90XCIgJiZcbiAgICAgICAgICAgIHJlc3BvbnNlLnBheWxvYWQuZXhwaXJhdGlvblRpbWVzdGFtcCAhPSBudWxsKSB7XG4gICAgICAgICAgICBleHBpcmF0aW9uVGltZXN0YW1wID0gcmVzcG9uc2UucGF5bG9hZC5leHBpcmF0aW9uVGltZXN0YW1wO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGV4cGlyYXRpb25UaW1lc3RhbXA7XG59O1xuLyoqXG4gKiBUaGlzIHBhY2thZ2UgaXMgaW50ZW50aW9uYWxseSBkZXNpZ25lZCB3aXRoIGEgc3Vic2NyaXB0aW9uLWJhc2VkIEFQSSBhcyBvcHBvc2VkIHRvIGEgcHJvbWlzZS1iYXNlZCBvbmUgd2hlcmUgZWFjaCBtZXNzYWdlIGNvcnJlc3BvbmRzIHRvIGEgc2luZ2xlIGJvdCByZXNwb25zZSwgYXZhaWxhYmxlIGFzeW5jaHJvbm91c2x5LlxuICpcbiAqIElmIHlvdSBuZWVkIGEgcHJvbWlzZS1iYXNlZCB3cmFwcGVyLCB5b3UgY2FuIHVzZSB0aGUgYHByb21pc2lmeWAgaGVscGVyIGF2YWlsYWJsZSBpbiB0aGUgcGFja2FnZTpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyBjcmVhdGVDb252ZXJzYXRpb24sIHByb21pc2lmeSB9IGZyb20gXCJAbmx4YWkvY2hhdC1jb3JlXCI7XG4gKlxuICogY29uc3QgY29udm8gPSBjcmVhdGVDb252ZXJzYXRpb24oY29uZmlnKTtcbiAqXG4gKiBjb25zdCBzZW5kVGV4dFdyYXBwZWQgPSBwcm9taXNpZnkoY29udm8uc2VuZFRleHQsIGNvbnZvKTtcbiAqXG4gKiBzZW5kVGV4dFdyYXBwZWQoXCJIZWxsb1wiKS50aGVuKChyZXNwb25zZSkgPT4ge1xuICogICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gKiB9KTtcbiAqIGBgYFxuICogQHR5cGVQYXJhbSBUIC0gdGhlIHR5cGUgb2YgdGhlIGZ1bmN0aW9uJ3MgcGFyYW1zLCBlLmcuIGZvciBgc2VuZFRleHRgIGl0J3MgYHRleHQ6IHN0cmluZywgY29udGV4dD86IENvbnRleHRgXG4gKiBAcGFyYW0gZm4gLSB0aGUgZnVuY3Rpb24gdG8gd3JhcCAoZS5nLiBgY29udm8uc2VuZFRleHRgLCBgY29udm8uc2VuZENob2ljZWAsIGV0Yy4pXG4gKiBAcGFyYW0gY29udm8gLSB0aGUgYENvbnZlcnNhdGlvbkhhbmRsZXJgIChmcm9tIHtAbGluayBjcmVhdGVDb252ZXJzYXRpb259KVxuICogQHBhcmFtIHRpbWVvdXQgLSB0aGUgdGltZW91dCBpbiBtaWxsaXNlY29uZHNcbiAqIEByZXR1cm5zIEEgcHJvbWlzZS13cmFwcGVkIHZlcnNpb24gb2YgdGhlIGZ1bmN0aW9uLiBUaGUgZnVuY3Rpb24sIHdoZW4gY2FsbGVkLCByZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBDb252ZXJzYXRpb24ncyBuZXh0IHJlc3BvbnNlLlxuICovXG5mdW5jdGlvbiBwcm9taXNpZnkoZm4sIGNvbnZvLCB0aW1lb3V0ID0gMTAwMDApIHtcbiAgICByZXR1cm4gYXN5bmMgKHBheWxvYWQpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJUaGUgcmVxdWVzdCB0aW1lZCBvdXQuXCIpKTtcbiAgICAgICAgICAgICAgICBjb252by51bnN1YnNjcmliZShzdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgfSwgdGltZW91dCk7XG4gICAgICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSAoX3Jlc3BvbnNlcywgbmV3UmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobmV3UmVzcG9uc2U/LnR5cGUgPT09IFwiYm90XCIgfHwgbmV3UmVzcG9uc2U/LnR5cGUgPT09IFwiZmFpbHVyZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgICAgICAgICAgICAgICBjb252by51bnN1YnNjcmliZShzdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG5ld1Jlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29udm8uc3Vic2NyaWJlKHN1YnNjcmlwdGlvbik7XG4gICAgICAgICAgICBmbihwYXlsb2FkKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cblxuZXhwb3J0IHsgY3JlYXRlQ29udmVyc2F0aW9uLCBnZXRDdXJyZW50RXhwaXJhdGlvblRpbWVzdGFtcCwgcHJvbWlzaWZ5LCBzaG91bGRSZWluaXRpYWxpemUgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@nlxai/chat-core/lib/index.esm.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@nlxai/chat-react/lib/index.esm.js":
/*!*********************************************************!*\
  !*** ./node_modules/@nlxai/chat-react/lib/index.esm.js ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ useChat),\n/* harmony export */   useChat: () => (/* binding */ useChat)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var ramda__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ramda */ \"(ssr)/./node_modules/ramda/es/last.js\");\n/* harmony import */ var _nlxai_chat_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @nlxai/chat-core */ \"(ssr)/./node_modules/@nlxai/chat-core/lib/index.esm.js\");\n\n\n\n\n/**\n * A [custom hook](https://react.dev/learn/reusing-logic-with-custom-hooks)\n * used to create fully custom chat widgets for web and mobile.\n * @param config - The configuration object for the chatbot.\n * @returns the hook object containing the chat state and methods.\n */\nconst useChat = (config) => {\n    const prevConversationHandler = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const prevConfig = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n        prevConfig.current = config;\n    }, [config]);\n    const conversationHandler = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {\n        // Prevent re-initialization if backend-related props have not changed\n        if (prevConfig.current != null &&\n            prevConversationHandler.current != null &&\n            !(0,_nlxai_chat_core__WEBPACK_IMPORTED_MODULE_1__.shouldReinitialize)(prevConfig.current, config)) {\n            return prevConversationHandler.current;\n        }\n        const newHandler = (0,_nlxai_chat_core__WEBPACK_IMPORTED_MODULE_1__.createConversation)(config);\n        prevConversationHandler.current = newHandler;\n        return newHandler;\n    }, [config]);\n    const [responses, setResponses] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(config.responses ?? []);\n    const [inputValue, setInputValue] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(\"\");\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n        conversationHandler.subscribe(setResponses);\n        return () => {\n            conversationHandler.destroy();\n        };\n    }, [conversationHandler]);\n    const lastMessage = (0,ramda__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(responses);\n    const isWaiting = lastMessage?.type === \"user\";\n    return {\n        conversationHandler,\n        inputValue,\n        responses,\n        waiting: isWaiting,\n        setInputValue,\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQG5seGFpL2NoYXQtcmVhY3QvbGliL2luZGV4LmVzbS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUE2RDtBQUNoQztBQUM2Qzs7QUFFMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsNkNBQU07QUFDMUMsdUJBQXVCLDZDQUFNO0FBQzdCLElBQUksZ0RBQVM7QUFDYjtBQUNBLEtBQUs7QUFDTCxnQ0FBZ0MsOENBQU87QUFDdkM7QUFDQTtBQUNBO0FBQ0EsYUFBYSxvRUFBa0I7QUFDL0I7QUFDQTtBQUNBLDJCQUEyQixvRUFBa0I7QUFDN0M7QUFDQTtBQUNBLEtBQUs7QUFDTCxzQ0FBc0MsK0NBQVE7QUFDOUMsd0NBQXdDLCtDQUFRO0FBQ2hELElBQUksZ0RBQVM7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCx3QkFBd0IsaURBQUk7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV1QyIsInNvdXJjZXMiOlsid2VicGFjazovL21hbnRpbmUtbWluaW1hbC1uZXh0LXRlbXBsYXRlLy4vbm9kZV9tb2R1bGVzL0BubHhhaS9jaGF0LXJlYWN0L2xpYi9pbmRleC5lc20uanM/MzRkYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VSZWYsIHVzZUVmZmVjdCwgdXNlTWVtbywgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBsYXN0IH0gZnJvbSAncmFtZGEnO1xuaW1wb3J0IHsgc2hvdWxkUmVpbml0aWFsaXplLCBjcmVhdGVDb252ZXJzYXRpb24gfSBmcm9tICdAbmx4YWkvY2hhdC1jb3JlJztcblxuLyoqXG4gKiBBIFtjdXN0b20gaG9va10oaHR0cHM6Ly9yZWFjdC5kZXYvbGVhcm4vcmV1c2luZy1sb2dpYy13aXRoLWN1c3RvbS1ob29rcylcbiAqIHVzZWQgdG8gY3JlYXRlIGZ1bGx5IGN1c3RvbSBjaGF0IHdpZGdldHMgZm9yIHdlYiBhbmQgbW9iaWxlLlxuICogQHBhcmFtIGNvbmZpZyAtIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdCBmb3IgdGhlIGNoYXRib3QuXG4gKiBAcmV0dXJucyB0aGUgaG9vayBvYmplY3QgY29udGFpbmluZyB0aGUgY2hhdCBzdGF0ZSBhbmQgbWV0aG9kcy5cbiAqL1xuY29uc3QgdXNlQ2hhdCA9IChjb25maWcpID0+IHtcbiAgICBjb25zdCBwcmV2Q29udmVyc2F0aW9uSGFuZGxlciA9IHVzZVJlZihudWxsKTtcbiAgICBjb25zdCBwcmV2Q29uZmlnID0gdXNlUmVmKG51bGwpO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIHByZXZDb25maWcuY3VycmVudCA9IGNvbmZpZztcbiAgICB9LCBbY29uZmlnXSk7XG4gICAgY29uc3QgY29udmVyc2F0aW9uSGFuZGxlciA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgICAvLyBQcmV2ZW50IHJlLWluaXRpYWxpemF0aW9uIGlmIGJhY2tlbmQtcmVsYXRlZCBwcm9wcyBoYXZlIG5vdCBjaGFuZ2VkXG4gICAgICAgIGlmIChwcmV2Q29uZmlnLmN1cnJlbnQgIT0gbnVsbCAmJlxuICAgICAgICAgICAgcHJldkNvbnZlcnNhdGlvbkhhbmRsZXIuY3VycmVudCAhPSBudWxsICYmXG4gICAgICAgICAgICAhc2hvdWxkUmVpbml0aWFsaXplKHByZXZDb25maWcuY3VycmVudCwgY29uZmlnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHByZXZDb252ZXJzYXRpb25IYW5kbGVyLmN1cnJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3SGFuZGxlciA9IGNyZWF0ZUNvbnZlcnNhdGlvbihjb25maWcpO1xuICAgICAgICBwcmV2Q29udmVyc2F0aW9uSGFuZGxlci5jdXJyZW50ID0gbmV3SGFuZGxlcjtcbiAgICAgICAgcmV0dXJuIG5ld0hhbmRsZXI7XG4gICAgfSwgW2NvbmZpZ10pO1xuICAgIGNvbnN0IFtyZXNwb25zZXMsIHNldFJlc3BvbnNlc10gPSB1c2VTdGF0ZShjb25maWcucmVzcG9uc2VzID8/IFtdKTtcbiAgICBjb25zdCBbaW5wdXRWYWx1ZSwgc2V0SW5wdXRWYWx1ZV0gPSB1c2VTdGF0ZShcIlwiKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBjb252ZXJzYXRpb25IYW5kbGVyLnN1YnNjcmliZShzZXRSZXNwb25zZXMpO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgY29udmVyc2F0aW9uSGFuZGxlci5kZXN0cm95KCk7XG4gICAgICAgIH07XG4gICAgfSwgW2NvbnZlcnNhdGlvbkhhbmRsZXJdKTtcbiAgICBjb25zdCBsYXN0TWVzc2FnZSA9IGxhc3QocmVzcG9uc2VzKTtcbiAgICBjb25zdCBpc1dhaXRpbmcgPSBsYXN0TWVzc2FnZT8udHlwZSA9PT0gXCJ1c2VyXCI7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY29udmVyc2F0aW9uSGFuZGxlcixcbiAgICAgICAgaW5wdXRWYWx1ZSxcbiAgICAgICAgcmVzcG9uc2VzLFxuICAgICAgICB3YWl0aW5nOiBpc1dhaXRpbmcsXG4gICAgICAgIHNldElucHV0VmFsdWUsXG4gICAgfTtcbn07XG5cbmV4cG9ydCB7IHVzZUNoYXQgYXMgZGVmYXVsdCwgdXNlQ2hhdCB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@nlxai/chat-react/lib/index.esm.js\n");

/***/ })

};
;